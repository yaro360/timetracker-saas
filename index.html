<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>TimeTracker - Multi-Company Platform v2.7 - EMAIL & MANAGER FEATURES</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            -webkit-text-size-adjust: 100%;
            -webkit-font-smoothing: antialiased;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            padding: 30px;
            margin-bottom: 20px;
        }

        .login-card {
            max-width: 400px;
            margin: 50px auto;
        }

        .logo {
            width: 60px;
            height: 60px;
            background: #4F46E5;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            margin: 0 auto 20px;
            font-size: 24px;
            font-weight: bold;
        }

        h1 {
            text-align: center;
            color: #1F2937;
            margin-bottom: 10px;
            font-size: 2rem;
            font-weight: 700;
        }

        h2 {
            color: #1F2937;
            margin-bottom: 20px;
            font-size: 1.5rem;
            font-weight: 600;
        }

        p {
            color: #6B7280;
            line-height: 1.6;
        }

        .subtitle {
            text-align: center;
            color: #374151;
            margin-bottom: 30px;
            font-size: 1rem;
            font-weight: 500;
        }

        .form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            font-weight: 500;
            color: #374151;
            font-size: 0.875rem;
        }

        .form-group input,
        .form-group select {
            padding: 12px 16px;
            border: 2px solid #E5E7EB;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.2s;
            background: white;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #4F46E5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            min-height: 44px;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-primary {
            background: #4F46E5;
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: #4338CA;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
        }

        .btn-outline {
            background: transparent;
            color: #4F46E5;
            border: 2px solid #4F46E5;
        }

        .btn-outline:hover:not(:disabled) {
            background: #4F46E5;
            color: white;
        }

        .tab-container {
            display: flex;
            background: #F3F4F6;
            border-radius: 8px;
            padding: 4px;
            margin-bottom: 20px;
        }

        .tab {
            flex: 1;
            padding: 12px 16px;
            background: transparent;
            border: none;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            color: #6B7280;
        }

        .tab.active {
            background: white;
            color: #4F46E5;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .demo-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #E5E7EB;
        }

        .demo-label {
            font-size: 0.875rem;
            color: #6B7280;
            margin-bottom: 10px;
            text-align: center;
        }

        .demo-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn-demo {
            background: #F3F4F6;
            color: #374151;
            border: 1px solid #D1D5DB;
            font-size: 0.875rem;
            padding: 8px 16px;
        }

        .btn-demo:hover {
            background: #E5E7EB;
        }

        .loading {
            text-align: center;
            color: white;
            font-size: 1.2rem;
            padding: 40px;
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 0.875rem;
            min-height: 36px;
        }

        .error {
            color: #e74c3c;
            background-color: #fdf2f2;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            border: 1px solid #fecaca;
        }

        .job-site-card {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
        }

        .job-site-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .job-site-modal-content {
            background: white;
            border-radius: 12px;
            padding: 20px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .address-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .address-form .full-width {
            grid-column: 1 / -1;
        }

        .map-container {
            height: 300px;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin: 15px 0;
        }

        .geocoding-section {
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .geocoding-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .map-error {
            color: #dc3545;
            font-size: 14px;
            margin-top: 10px;
        }

        .spinning {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .btn-sm {
            padding: 4px 8px;
            font-size: 12px;
            border-radius: 4px;
        }

        .employee-card, .job-site-card {
            transition: all 0.2s ease;
        }

        .employee-card:hover, .job-site-card:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transform: translateY(-1px);
        }

        .btn-group {
            display: flex;
            gap: 5px;
        }
    </style>
</head>
<body>
    <div id="root">
        <div class="loading">Loading TimeTracker...</div>
    </div>
    
    <script type="text/babel">
        const { useState, useEffect, createContext, useContext } = React;
        const { createRoot } = ReactDOM;

        // Auth Context
        const AuthContext = createContext();

        const useAuth = () => {
            const context = useContext(AuthContext);
            if (!context) {
                throw new Error('useAuth must be used within an AuthProvider');
            }
            return context;
        };

        const AuthProvider = ({ children }) => {
            const [user, setUser] = useState(null);

            const login = (username, password, role = null) => {
                try {
                    console.log('Attempting login for:', username, 'with role:', role);
                    const users = JSON.parse(localStorage.getItem('users') || '[]');
                    console.log('Available users:', users.map(u => ({ username: u.username, role: u.role })));
                    
                    let foundUser;
                    if (role) {
                        // Look for specific role
                        foundUser = users.find(u => 
                            u.username === username && 
                            u.password === password && 
                            u.role === role
                        );
                    } else {
                        // Look for any matching user
                        foundUser = users.find(u => u.username === username && u.password === password);
                    }
                    
                    if (foundUser) {
                        console.log('Login successful for:', username, 'as', foundUser.role);
                        const userData = { ...foundUser };
                        delete userData.password;
                        setUser(userData);
                        localStorage.setItem('currentUser', JSON.stringify(userData));
                        return true;
                    } else {
                        console.log('Login failed - user not found or wrong password/role');
                        return false;
                    }
                } catch (error) {
                    console.error('Login error:', error);
                    return false;
                }
            };

            const logout = () => {
                setUser(null);
                localStorage.removeItem('currentUser');
            };

            const register = (userData) => {
                try {
                    console.log('Registering new user:', userData);
                    const users = JSON.parse(localStorage.getItem('users') || '[]');
                    
                    if (users.find(u => u.username === userData.username)) {
                        alert('Username already exists');
                        return false;
                    }

                    if (users.find(u => u.email === userData.email)) {
                        alert('Email already exists');
                        return false;
                    }

                    const newUser = {
                        id: Date.now().toString(),
                        ...userData,
                        companyId: null, // New users start without a company
                        createdAt: new Date().toISOString()
                    };

                    users.push(newUser);
                    localStorage.setItem('users', JSON.stringify(users));
                    
                    console.log('User registered successfully:', newUser);
                    console.log('All users now:', users);
                    
                    const userDataForState = { ...newUser };
                    delete userDataForState.password;
                    setUser(userDataForState);
                    localStorage.setItem('currentUser', JSON.stringify(userDataForState));
                    
                    return true;
                } catch (error) {
                    console.error('Registration error:', error);
                    return false;
                }
            };

            const createCompany = (companyData, ownerData) => {
                try {
                    console.log('Creating company:', companyData);
                    console.log('Creating owner:', ownerData);
                    
                    const companies = JSON.parse(localStorage.getItem('companies') || '[]');
                    const users = JSON.parse(localStorage.getItem('users') || '[]');
                    
                    if (companies.find(c => c.name === companyData.name)) {
                        alert('Company name already exists');
                        return false;
                    }

                    if (users.find(u => u.username === ownerData.username)) {
                        alert('Username already exists');
                        return false;
                    }

                    if (users.find(u => u.email === ownerData.email)) {
                        alert('Email already exists');
                        return false;
                    }

                    const companyId = Date.now().toString();
                    const ownerId = (Date.now() + 1).toString();

                    const newCompany = {
                        id: companyId,
                        ...companyData,
                        createdAt: new Date().toISOString()
                    };

                    const newOwner = {
                        id: ownerId,
                        ...ownerData,
                        companyId: companyId,
                        role: 'owner',
                        createdAt: new Date().toISOString()
                    };

                    companies.push(newCompany);
                    users.push(newOwner);
                    
                    localStorage.setItem('companies', JSON.stringify(companies));
                    localStorage.setItem('users', JSON.stringify(users));
                    
                    console.log('Company created successfully:', newCompany);
                    console.log('Owner created successfully:', newOwner);
                    console.log('All companies now:', companies);
                    console.log('All users now:', users);
                    
                    const userDataForState = { ...newOwner };
                    delete userDataForState.password;
                    setUser(userDataForState);
                    localStorage.setItem('currentUser', JSON.stringify(userDataForState));
                    
                    return true;
                } catch (error) {
                    console.error('Company creation error:', error);
                    return false;
                }
            };

            const value = {
                user,
                login,
                logout,
                register,
                createCompany
            };

            return React.createElement(AuthContext.Provider, { value }, children);
        };

        // Login Form Component
        const LoginForm = ({ onLogin }) => {
            const [formData, setFormData] = useState({
                username: '',
                password: '',
                role: ''
            });
            const [isLoading, setIsLoading] = useState(false);
            const [availableRoles, setAvailableRoles] = useState([]);
            const [showRoleSelection, setShowRoleSelection] = useState(false);

            const handleChange = (e) => {
                setFormData({
                    ...formData,
                    [e.target.name]: e.target.value
                });
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                setIsLoading(true);

                try {
                    // First check if there are multiple users with same username/password but different roles
                    const users = JSON.parse(localStorage.getItem('users') || '[]');
                    const matchingUsers = users.filter(u => 
                        u.username === formData.username && u.password === formData.password
                    );

                    console.log('Matching users found:', matchingUsers);

                    if (matchingUsers.length === 0) {
                        alert('Invalid credentials. Please try again.');
                        setIsLoading(false);
                        return;
                    }

                    if (matchingUsers.length === 1) {
                        // Single user found, login directly
                        const success = onLogin(formData.username, formData.password, matchingUsers[0].role);
                        if (!success) {
                            alert('Login failed. Please try again.');
                        }
                    } else {
                        // Multiple users found, show role selection
                        const roles = matchingUsers.map(u => ({
                            role: u.role,
                            companyId: u.companyId,
                            firstName: u.firstName,
                            lastName: u.lastName
                        }));
                        setAvailableRoles(roles);
                        setShowRoleSelection(true);
                    }
                } catch (error) {
                    console.error('Login error:', error);
                    alert('Login failed. Please try again.');
                } finally {
                    setIsLoading(false);
                }
            };

            const handleRoleSelection = (selectedRole) => {
                const success = onLogin(formData.username, formData.password, selectedRole);
                if (success) {
                    setShowRoleSelection(false);
                    setAvailableRoles([]);
                } else {
                    alert('Login failed. Please try again.');
                }
            };

            const handleDemoLogin = (role) => {
                console.log('Demo login clicked for role:', role);
                const demoCredentials = {
                    owner: { username: 'demo-owner', password: 'password' },
                    manager: { username: 'demo-manager', password: 'password' },
                    employee: { username: 'demo-employee', password: 'password' }
                };

                const credentials = demoCredentials[role];
                if (credentials) {
                    console.log('Using demo credentials:', credentials);
                    setFormData(credentials);
                    const success = onLogin(credentials.username, credentials.password);
                    if (!success) {
                        console.error('Demo login failed!');
                        // Show current users for debugging
                        const users = JSON.parse(localStorage.getItem('users') || '[]');
                        console.log('Current users in localStorage:', users);
                        alert('Demo login failed. Check console for details and try "Show All Accounts" button.');
                    }
                }
            };

            return React.createElement('div', null,
                React.createElement('form', { onSubmit: handleSubmit, className: 'form' },
                    React.createElement('div', { className: 'form-group' },
                        React.createElement('label', { htmlFor: 'username' }, 'Username'),
                        React.createElement('input', {
                            type: 'text',
                            id: 'username',
                            name: 'username',
                            value: formData.username,
                            onChange: handleChange,
                            required: true,
                            placeholder: 'Enter your username'
                        })
                    ),
                    React.createElement('div', { className: 'form-group' },
                        React.createElement('label', { htmlFor: 'password' }, 'Password'),
                        React.createElement('input', {
                            type: 'password',
                            id: 'password',
                            name: 'password',
                            value: formData.password,
                            onChange: handleChange,
                            required: true,
                            placeholder: 'Enter your password'
                        })
                    ),
                    React.createElement('button', { 
                        type: 'submit', 
                        className: 'btn btn-primary',
                        disabled: isLoading
                    }, isLoading ? 'Signing in...' : 'Sign In'),
                    React.createElement('div', { className: 'demo-section' },
                        React.createElement('p', { className: 'demo-label' }, 'Quick Demo Access:'),
                        React.createElement('div', { className: 'demo-buttons' },
                            React.createElement('button', {
                                type: 'button',
                                className: 'btn btn-demo',
                                onClick: () => handleDemoLogin('owner')
                            }, 'Owner Demo'),
                            React.createElement('button', {
                                type: 'button',
                                className: 'btn btn-demo',
                                onClick: () => handleDemoLogin('manager')
                            }, 'Manager Demo'),
                            React.createElement('button', {
                                type: 'button',
                                className: 'btn btn-demo',
                                onClick: () => handleDemoLogin('employee')
                            }, 'Employee Demo')
                        ),
                        React.createElement('div', { style: { marginTop: '15px', textAlign: 'center' } },
                            React.createElement('button', {
                                type: 'button',
                                className: 'btn btn-outline btn-sm',
                                onClick: () => {
                                    if (confirm('Reset all data and reload demo accounts? This will delete any custom users you created.')) {
                                        localStorage.clear();
                                        window.location.reload();
                                    }
                                }
                            }, 'ðŸ”„ Reset Demo Data'),
                            React.createElement('button', {
                                type: 'button',
                                className: 'btn btn-outline btn-sm',
                                style: { marginLeft: '10px' },
                                onClick: () => {
                                    const users = JSON.parse(localStorage.getItem('users') || '[]');
                                    const userList = users.map(u => `${u.username} (${u.role}) - ${u.firstName} ${u.lastName}`).join('\n');
                                    alert(`All Accounts:\n\n${userList || 'No accounts found'}`);
                                    console.log('All users in localStorage:', users);
                                }
                            }, 'ðŸ‘¥ Show All Accounts')
                        )
                    )
                ),
                
                // Role Selection Modal
                showRoleSelection && React.createElement('div', { 
                    style: { 
                        position: 'fixed', 
                        top: 0, 
                        left: 0, 
                        right: 0, 
                        bottom: 0, 
                        backgroundColor: 'rgba(0,0,0,0.5)', 
                        display: 'flex', 
                        alignItems: 'center', 
                        justifyContent: 'center',
                        zIndex: 1000
                    } 
                },
                    React.createElement('div', { 
                        style: { 
                            backgroundColor: 'white', 
                            padding: '30px', 
                            borderRadius: '12px', 
                            maxWidth: '400px', 
                            width: '90%',
                            boxShadow: '0 10px 25px rgba(0,0,0,0.2)'
                        } 
                    },
                        React.createElement('h3', { style: { marginBottom: '20px', textAlign: 'center' } }, 'Select Your Role'),
                        React.createElement('p', { style: { marginBottom: '20px', color: '#666', textAlign: 'center' } }, 
                            'Multiple roles found for this account. Please select which role you want to login as:'
                        ),
                        React.createElement('div', { style: { display: 'flex', flexDirection: 'column', gap: '10px' } },
                            availableRoles.map((roleInfo, index) => 
                                React.createElement('button', {
                                    key: index,
                                    type: 'button',
                                    className: 'btn btn-outline',
                                    style: { 
                                        textAlign: 'left', 
                                        padding: '15px',
                                        display: 'flex',
                                        flexDirection: 'column',
                                        alignItems: 'flex-start'
                                    },
                                    onClick: () => handleRoleSelection(roleInfo.role)
                                },
                                    React.createElement('div', { style: { fontWeight: 'bold', fontSize: '1.1rem' } }, 
                                        roleInfo.role.charAt(0).toUpperCase() + roleInfo.role.slice(1)
                                    ),
                                    React.createElement('div', { style: { fontSize: '0.9rem', color: '#666' } }, 
                                        `${roleInfo.firstName} ${roleInfo.lastName}`
                                    ),
                                    roleInfo.companyId && React.createElement('div', { style: { fontSize: '0.8rem', color: '#999' } }, 
                                        'Company ID: ' + roleInfo.companyId
                                    )
                                )
                            )
                        ),
                        React.createElement('button', {
                            type: 'button',
                            className: 'btn btn-outline',
                            style: { marginTop: '20px', width: '100%' },
                            onClick: () => {
                                setShowRoleSelection(false);
                                setAvailableRoles([]);
                            }
                        }, 'Cancel')
                    )
                )
            );
        };

        // Register Form Component
        const RegisterForm = ({ onRegister }) => {
            const [formData, setFormData] = useState({
                firstName: '',
                lastName: '',
                username: '',
                email: '',
                password: '',
                confirmPassword: '',
                role: 'employee'
            });
            const [isLoading, setIsLoading] = useState(false);

            const handleChange = (e) => {
                setFormData({
                    ...formData,
                    [e.target.name]: e.target.value
                });
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                setIsLoading(true);

                if (formData.password !== formData.confirmPassword) {
                    alert('Passwords do not match');
                    setIsLoading(false);
                    return;
                }

                if (formData.password.length < 6) {
                    alert('Password must be at least 6 characters long');
                    setIsLoading(false);
                    return;
                }

                try {
                    const userData = {
                        firstName: formData.firstName,
                        lastName: formData.lastName,
                        username: formData.username,
                        email: formData.email,
                        password: formData.password,
                        role: formData.role,
                        companyId: null
                    };

                    const success = onRegister(userData);
                    if (!success) {
                        alert('Registration failed. Username or email may already exist.');
                    }
                } catch (error) {
                    console.error('Registration error:', error);
                    alert('Registration failed. Please try again.');
                } finally {
                    setIsLoading(false);
                }
            };

            return React.createElement('form', { onSubmit: handleSubmit, className: 'form' },
                React.createElement('div', { style: { display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '15px' } },
                    React.createElement('div', { className: 'form-group' },
                        React.createElement('label', { htmlFor: 'firstName' }, 'First Name'),
                        React.createElement('input', {
                            type: 'text',
                            id: 'firstName',
                            name: 'firstName',
                            value: formData.firstName,
                            onChange: handleChange,
                            required: true,
                            placeholder: 'Enter first name'
                        })
                    ),
                    React.createElement('div', { className: 'form-group' },
                        React.createElement('label', { htmlFor: 'lastName' }, 'Last Name'),
                        React.createElement('input', {
                            type: 'text',
                            id: 'lastName',
                            name: 'lastName',
                            value: formData.lastName,
                            onChange: handleChange,
                            required: true,
                            placeholder: 'Enter last name'
                        })
                    )
                ),
                React.createElement('div', { className: 'form-group' },
                    React.createElement('label', { htmlFor: 'username' }, 'Username'),
                    React.createElement('input', {
                        type: 'text',
                        id: 'username',
                        name: 'username',
                        value: formData.username,
                        onChange: handleChange,
                        required: true,
                        placeholder: 'Choose a username'
                    })
                ),
                React.createElement('div', { className: 'form-group' },
                    React.createElement('label', { htmlFor: 'email' }, 'Email'),
                    React.createElement('input', {
                        type: 'email',
                        id: 'email',
                        name: 'email',
                        value: formData.email,
                        onChange: handleChange,
                        required: true,
                        placeholder: 'Enter your email'
                    })
                ),
                React.createElement('div', { className: 'form-group' },
                    React.createElement('label', { htmlFor: 'role' }, 'Role'),
                    React.createElement('select', {
                        id: 'role',
                        name: 'role',
                        value: formData.role,
                        onChange: handleChange,
                        required: true
                    },
                        React.createElement('option', { value: 'employee' }, 'Employee'),
                        React.createElement('option', { value: 'manager' }, 'Manager')
                    )
                ),
                React.createElement('div', { className: 'form-group' },
                    React.createElement('label', { htmlFor: 'password' }, 'Password'),
                    React.createElement('input', {
                        type: 'password',
                        id: 'password',
                        name: 'password',
                        value: formData.password,
                        onChange: handleChange,
                        required: true,
                        placeholder: 'Create a password',
                        minLength: 6
                    })
                ),
                React.createElement('div', { className: 'form-group' },
                    React.createElement('label', { htmlFor: 'confirmPassword' }, 'Confirm Password'),
                    React.createElement('input', {
                        type: 'password',
                        id: 'confirmPassword',
                        name: 'confirmPassword',
                        value: formData.confirmPassword,
                        onChange: handleChange,
                        required: true,
                        placeholder: 'Confirm your password',
                        minLength: 6
                    })
                ),
                React.createElement('button', { 
                    type: 'submit', 
                    className: 'btn btn-primary',
                    disabled: isLoading
                }, isLoading ? 'Creating Account...' : 'Create Account')
            );
        };

        // Company Registration Component
        const CompanyRegistration = ({ onCompanyRegistration }) => {
            const [step, setStep] = useState(1);
            const [companyData, setCompanyData] = useState({
                name: '',
                industry: 'construction',
                address: '',
                phone: '',
                email: ''
            });
            const [ownerData, setOwnerData] = useState({
                firstName: '',
                lastName: '',
                username: '',
                email: '',
                password: '',
                confirmPassword: ''
            });
            const [isLoading, setIsLoading] = useState(false);

            const industries = [
                { value: 'construction', label: 'Construction' },
                { value: 'healthcare', label: 'Healthcare' },
                { value: 'retail', label: 'Retail' },
                { value: 'manufacturing', label: 'Manufacturing' },
                { value: 'transportation', label: 'Transportation' },
                { value: 'security', label: 'Security' },
                { value: 'cleaning', label: 'Cleaning Services' },
                { value: 'other', label: 'Other' }
            ];

            const handleCompanyChange = (e) => {
                setCompanyData({
                    ...companyData,
                    [e.target.name]: e.target.value
                });
            };

            const handleOwnerChange = (e) => {
                setOwnerData({
                    ...ownerData,
                    [e.target.name]: e.target.value
                });
            };

            const handleNext = () => {
                if (step === 1) {
                    if (!companyData.name || !companyData.industry || !companyData.email) {
                        alert('Please fill in all required company fields');
                        return;
                    }
                    setStep(2);
                }
            };

            const handleBack = () => {
                setStep(1);
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                setIsLoading(true);

                if (ownerData.password !== ownerData.confirmPassword) {
                    alert('Passwords do not match');
                    setIsLoading(false);
                    return;
                }

                if (ownerData.password.length < 6) {
                    alert('Password must be at least 6 characters long');
                    setIsLoading(false);
                    return;
                }

                try {
                    const success = onCompanyRegistration(companyData, {
                        ...ownerData,
                        role: 'owner'
                    });
                    
                    if (!success) {
                        alert('Company registration failed. Username or email may already exist.');
                    }
                } catch (error) {
                    console.error('Company registration error:', error);
                    alert('Company registration failed. Please try again.');
                } finally {
                    setIsLoading(false);
                }
            };

            if (step === 1) {
                return React.createElement('form', { onSubmit: (e) => { e.preventDefault(); handleNext(); }, className: 'form' },
                    React.createElement('div', { className: 'form-group' },
                        React.createElement('label', { htmlFor: 'name' }, 'Company Name *'),
                        React.createElement('input', {
                            type: 'text',
                            id: 'name',
                            name: 'name',
                            value: companyData.name,
                            onChange: handleCompanyChange,
                            required: true,
                            placeholder: 'Enter company name'
                        })
                    ),
                    React.createElement('div', { className: 'form-group' },
                        React.createElement('label', { htmlFor: 'industry' }, 'Industry *'),
                        React.createElement('select', {
                            id: 'industry',
                            name: 'industry',
                            value: companyData.industry,
                            onChange: handleCompanyChange,
                            required: true
                        }, industries.map(industry => 
                            React.createElement('option', { key: industry.value, value: industry.value }, industry.label)
                        ))
                    ),
                    React.createElement('div', { className: 'form-group' },
                        React.createElement('label', { htmlFor: 'address' }, 'Company Address'),
                        React.createElement('input', {
                            type: 'text',
                            id: 'address',
                            name: 'address',
                            value: companyData.address,
                            onChange: handleCompanyChange,
                            placeholder: 'Enter company address'
                        })
                    ),
                    React.createElement('div', { style: { display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '15px' } },
                        React.createElement('div', { className: 'form-group' },
                            React.createElement('label', { htmlFor: 'phone' }, 'Phone Number'),
                            React.createElement('input', {
                                type: 'tel',
                                id: 'phone',
                                name: 'phone',
                                value: companyData.phone,
                                onChange: handleCompanyChange,
                                placeholder: 'Enter phone number'
                            })
                        ),
                        React.createElement('div', { className: 'form-group' },
                            React.createElement('label', { htmlFor: 'email' }, 'Company Email *'),
                            React.createElement('input', {
                                type: 'email',
                                id: 'email',
                                name: 'email',
                                value: companyData.email,
                                onChange: handleCompanyChange,
                                required: true,
                                placeholder: 'Enter company email'
                            })
                        )
                    ),
                    React.createElement('button', { type: 'submit', className: 'btn btn-primary' }, 'Next: Owner Account')
                );
            }

            return React.createElement('form', { onSubmit: handleSubmit, className: 'form' },
                React.createElement('div', { style: { display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '15px' } },
                    React.createElement('div', { className: 'form-group' },
                        React.createElement('label', { htmlFor: 'firstName' }, 'First Name'),
                        React.createElement('input', {
                            type: 'text',
                            id: 'firstName',
                            name: 'firstName',
                            value: ownerData.firstName,
                            onChange: handleOwnerChange,
                            required: true,
                            placeholder: 'Enter first name'
                        })
                    ),
                    React.createElement('div', { className: 'form-group' },
                        React.createElement('label', { htmlFor: 'lastName' }, 'Last Name'),
                        React.createElement('input', {
                            type: 'text',
                            id: 'lastName',
                            name: 'lastName',
                            value: ownerData.lastName,
                            onChange: handleOwnerChange,
                            required: true,
                            placeholder: 'Enter last name'
                        })
                    )
                ),
                React.createElement('div', { className: 'form-group' },
                    React.createElement('label', { htmlFor: 'username' }, 'Username'),
                    React.createElement('input', {
                        type: 'text',
                        id: 'username',
                        name: 'username',
                        value: ownerData.username,
                        onChange: handleOwnerChange,
                        required: true,
                        placeholder: 'Choose a username'
                    })
                ),
                React.createElement('div', { className: 'form-group' },
                    React.createElement('label', { htmlFor: 'email' }, 'Email'),
                    React.createElement('input', {
                        type: 'email',
                        id: 'email',
                        name: 'email',
                        value: ownerData.email,
                        onChange: handleOwnerChange,
                        required: true,
                        placeholder: 'Enter your email'
                    })
                ),
                React.createElement('div', { className: 'form-group' },
                    React.createElement('label', { htmlFor: 'password' }, 'Password'),
                    React.createElement('input', {
                        type: 'password',
                        id: 'password',
                        name: 'password',
                        value: ownerData.password,
                        onChange: handleOwnerChange,
                        required: true,
                        placeholder: 'Create a password',
                        minLength: 6
                    })
                ),
                React.createElement('div', { className: 'form-group' },
                    React.createElement('label', { htmlFor: 'confirmPassword' }, 'Confirm Password'),
                    React.createElement('input', {
                        type: 'password',
                        id: 'confirmPassword',
                        name: 'confirmPassword',
                        value: ownerData.confirmPassword,
                        onChange: handleOwnerChange,
                        required: true,
                        placeholder: 'Confirm your password',
                        minLength: 6
                    })
                ),
                React.createElement('div', { style: { display: 'flex', gap: '12px', justifyContent: 'space-between', marginTop: '24px' } },
                    React.createElement('button', { 
                        type: 'button', 
                        className: 'btn btn-outline',
                        onClick: handleBack
                    }, 'Back'),
                    React.createElement('button', { 
                        type: 'submit', 
                        className: 'btn btn-primary',
                        disabled: isLoading
                    }, isLoading ? 'Creating Company...' : 'Create Company')
                )
            );
        };

        // Clear all data and initialize fresh demo data
        const initializeDemoData = () => {
            console.log('Initializing fresh demo data...');
            
            // Always clear and reinitialize for fresh start
            console.log('Clearing localStorage and reinitializing...');
            localStorage.clear();
            
            // Create demo users
            const demoUsers = [
                {
                    id: 'demo-owner-1',
                    username: 'demo-owner',
                    password: 'password',
                    email: 'owner@democonstruction.com',
                    firstName: 'Demo',
                    lastName: 'Owner',
                    role: 'owner',
                    companyId: 'demo-company-1',
                    createdAt: new Date().toISOString()
                },
                {
                    id: 'demo-manager-1',
                    username: 'demo-manager',
                    password: 'password',
                    email: 'manager@democonstruction.com',
                    firstName: 'Demo',
                    lastName: 'Manager',
                    role: 'manager',
                    companyId: 'demo-company-1',
                    createdAt: new Date().toISOString()
                },
                {
                    id: 'demo-employee-1',
                    username: 'demo-employee',
                    password: 'password',
                    email: 'employee@democonstruction.com',
                    firstName: 'Demo',
                    lastName: 'Employee',
                    role: 'employee',
                    companyId: 'demo-company-1',
                    createdAt: new Date().toISOString()
                },
                // Test user with multiple roles
                {
                    id: 'test-multi-1',
                    username: 'testuser',
                    password: 'test123',
                    email: 'test@example.com',
                    firstName: 'Test',
                    lastName: 'User',
                    role: 'owner',
                    companyId: 'test-company-1',
                    createdAt: new Date().toISOString()
                },
                {
                    id: 'test-multi-2',
                    username: 'testuser',
                    password: 'test123',
                    email: 'test@example.com',
                    firstName: 'Test',
                    lastName: 'User',
                    role: 'manager',
                    companyId: 'test-company-2',
                    createdAt: new Date().toISOString()
                },
                {
                    id: 'test-multi-3',
                    username: 'testuser',
                    password: 'test123',
                    email: 'test@example.com',
                    firstName: 'Test',
                    lastName: 'User',
                    role: 'employee',
                    companyId: 'test-company-3',
                    createdAt: new Date().toISOString()
                }
            ];

            // Create demo company
            const demoCompany = {
                id: 'demo-company-1',
                name: 'Demo Construction Co.',
                industry: 'construction',
                address: '123 Demo Street, Demo City, DC 12345',
                phone: '(555) 123-4567',
                email: 'info@democonstruction.com',
                createdAt: new Date().toISOString()
            };

            // Create demo job sites
            const demoJobSites = [
                {
                    id: 'demo-site-1',
                    name: 'Downtown Office',
                    address: '123 Main Street, New York, NY 10001',
                    latitude: 40.7128,
                    longitude: -74.0060,
                    radius: 100,
                    description: 'Primary office location in downtown Manhattan',
                    companyId: 'demo-company-1',
                    createdAt: new Date().toISOString()
                },
                {
                    id: 'demo-site-2',
                    name: 'Brooklyn Warehouse',
                    address: '456 Industrial Blvd, Brooklyn, NY 11201',
                    latitude: 40.6892,
                    longitude: -73.9442,
                    radius: 150,
                    description: 'Main warehouse and distribution center',
                    companyId: 'demo-company-1',
                    createdAt: new Date().toISOString()
                },
                {
                    id: 'demo-site-3',
                    name: 'Queens Construction Site',
                    address: '789 Development Ave, Queens, NY 11375',
                    latitude: 40.7282,
                    longitude: -73.7949,
                    radius: 200,
                    description: 'Active construction project site',
                    companyId: 'demo-company-1',
                    createdAt: new Date().toISOString()
                }
            ];

            // Save to localStorage
            localStorage.setItem('users', JSON.stringify(demoUsers));
            localStorage.setItem('companies', JSON.stringify([demoCompany]));
            localStorage.setItem('jobSites', JSON.stringify(demoJobSites));
            localStorage.setItem('timeEntries', JSON.stringify([]));
            localStorage.setItem('demoDataInitialized', 'true');
            
            console.log('Demo data initialized successfully!');
            console.log('Available demo accounts:');
            console.log('- Owner: demo-owner / password');
            console.log('- Manager: demo-manager / password');
            console.log('- Employee: demo-employee / password');
            console.log('- Multi-role test: testuser / test123 (has owner, manager, and employee roles)');
        };

        // Initialize demo data on page load
        initializeDemoData();

        // Data Context for location and other utilities
        const DataContext = createContext();

        const useData = () => {
            const context = useContext(DataContext);
            if (!context) {
                throw new Error('useData must be used within a DataProvider');
            }
            return context;
        };

        const DataProvider = ({ children }) => {
            const { user } = useAuth();
            const [currentLocation, setCurrentLocation] = useState(null);
            const [companies, setCompanies] = useState([]);
            const [users, setUsers] = useState([]);
            const [jobSites, setJobSites] = useState([]);
            const [timeEntries, setTimeEntries] = useState([]);

            // Load company-specific data when user changes
            useEffect(() => {
                if (user && user.companyId) {
                    loadCompanyData();
                }
            }, [user]);

            const loadCompanyData = () => {
                if (!user || !user.companyId) return;

                try {
                    console.log('Loading data for company:', user.companyId);
                    
                    const allCompanies = JSON.parse(localStorage.getItem('companies') || '[]');
                    const allUsers = JSON.parse(localStorage.getItem('users') || '[]');
                    const allJobSites = JSON.parse(localStorage.getItem('jobSites') || '[]');
                    const allTimeEntries = JSON.parse(localStorage.getItem('timeEntries') || '[]');

                    // STRICT DATA ISOLATION - Only show data from user's company
                    const userCompany = allCompanies.find(c => c.id === user.companyId);
                    const companyUsers = allUsers.filter(u => u.companyId === user.companyId);
                    const companyJobSites = allJobSites.filter(j => j.companyId === user.companyId);
                    const companyTimeEntries = allTimeEntries.filter(t => t.companyId === user.companyId);

                    console.log('Company data loaded:', {
                        company: userCompany?.name || 'No company',
                        users: companyUsers.length,
                        jobSites: companyJobSites.length,
                        timeEntries: companyTimeEntries.length
                    });

                    setCompanies(userCompany ? [userCompany] : []);
                    setUsers(companyUsers);
                    setJobSites(companyJobSites);
                    setTimeEntries(companyTimeEntries);
                } catch (error) {
                    console.error('Error loading company data:', error);
                }
            };

            // Data management functions with company isolation
            const addUser = (userData) => {
                if (!user || !user.companyId) return;
                
                const newUser = {
                    ...userData,
                    companyId: user.companyId,
                    id: Date.now().toString(),
                    createdAt: new Date().toISOString()
                };
                
                const allUsers = JSON.parse(localStorage.getItem('users') || '[]');
                allUsers.push(newUser);
                localStorage.setItem('users', JSON.stringify(allUsers));
                loadCompanyData(); // Reload to show new user
            };

            const addJobSite = (jobSiteData) => {
                if (!user || !user.companyId) return;
                
                const newJobSite = {
                    ...jobSiteData,
                    companyId: user.companyId,
                    id: Date.now().toString(),
                    createdAt: new Date().toISOString()
                };
                
                const allJobSites = JSON.parse(localStorage.getItem('jobSites') || '[]');
                allJobSites.push(newJobSite);
                localStorage.setItem('jobSites', JSON.stringify(allJobSites));
                loadCompanyData(); // Reload to show new job site
            };

            const addTimeEntry = (timeEntryData) => {
                if (!user || !user.companyId) return;
                
                const newTimeEntry = {
                    ...timeEntryData,
                    companyId: user.companyId,
                    id: Date.now().toString(),
                    createdAt: new Date().toISOString()
                };
                
                const allTimeEntries = JSON.parse(localStorage.getItem('timeEntries') || '[]');
                allTimeEntries.push(newTimeEntry);
                localStorage.setItem('timeEntries', JSON.stringify(allTimeEntries));
                loadCompanyData(); // Reload to show new time entry
            };

            const getCurrentLocation = () => {
                return new Promise((resolve, reject) => {
                    console.log('Requesting location...');
                    console.log('Protocol:', window.location.protocol);
                    console.log('User Agent:', navigator.userAgent);
                    
                    if (!navigator.geolocation) {
                        const error = new Error('Geolocation is not supported by this browser. Please use a modern browser with GPS support.');
                        console.error(error);
                        reject(error);
                        return;
                    }

                    // Check if we're on HTTPS (required for geolocation on mobile)
                    if (window.location.protocol !== 'https:' && window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {
                        const error = new Error('HTTPS is required for location access on mobile devices. Please access via https:// or use localhost.');
                        console.error(error);
                        reject(error);
                        return;
                    }

                    console.log('Geolocation API available, requesting position...');

                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            console.log('Location obtained:', position);
                            const location = {
                                lat: position.coords.latitude,
                                lng: position.coords.longitude,
                                accuracy: position.coords.accuracy,
                                altitude: position.coords.altitude,
                                heading: position.coords.heading,
                                speed: position.coords.speed,
                                timestamp: position.timestamp
                            };
                            console.log('Processed location:', location);
                            setCurrentLocation(location);
                            resolve(location);
                        },
                        (error) => {
                            console.error('Geolocation error:', error);
                            console.error('Error code:', error.code);
                            console.error('Error message:', error.message);
                            
                            let errorMessage = 'Unknown geolocation error';
                            switch (error.code) {
                                case error.PERMISSION_DENIED:
                                    errorMessage = 'Location access denied. Please:\n1. Allow location access in your browser settings\n2. Make sure you\'re using HTTPS\n3. Try refreshing the page';
                                    break;
                                case error.POSITION_UNAVAILABLE:
                                    errorMessage = 'Location information is unavailable. Please:\n1. Check your GPS settings\n2. Make sure location services are enabled\n3. Try moving to an area with better signal';
                                    break;
                                case error.TIMEOUT:
                                    errorMessage = 'Location request timed out. Please:\n1. Try again in a few seconds\n2. Make sure you\'re not in a building with poor GPS signal\n3. Check your internet connection';
                                    break;
                            }
                            
                            console.error('Geolocation error details:', errorMessage);
                            reject(new Error(errorMessage));
                        },
                        {
                            enableHighAccuracy: true,
                            timeout: 60000, // Increased timeout for mobile
                            maximumAge: 300000 // 5 minutes
                        }
                    );
                });
            };

            const calculateDistance = (lat1, lon1, lat2, lon2) => {
                const R = 6371e3; // Earth's radius in meters
                const Ï†1 = lat1 * Math.PI / 180;
                const Ï†2 = lat2 * Math.PI / 180;
                const Î”Ï† = (lat2 - lat1) * Math.PI / 180;
                const Î”Î» = (lon2 - lon1) * Math.PI / 180;

                const a = Math.sin(Î”Ï†/2) * Math.sin(Î”Ï†/2) +
                          Math.cos(Ï†1) * Math.cos(Ï†2) *
                          Math.sin(Î”Î»/2) * Math.sin(Î”Î»/2);
                const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));

                return R * c; // Distance in meters
            };

            const value = {
                currentLocation,
                setCurrentLocation,
                companies,
                users,
                jobSites,
                timeEntries,
                addUser,
                addJobSite,
                addTimeEntry,
                getCurrentLocation,
                calculateDistance,
                loadCompanyData
            };

            return React.createElement(DataContext.Provider, { value }, children);
        };

        // JobSiteModal Component with Address Fields and Interactive Map
        const JobSiteModal = ({ isOpen, onClose, onSave, initialData }) => {
            const [formData, setFormData] = useState({
                name: '',
                address1: '',
                address2: '',
                city: '',
                state: '',
                zipCode: '',
                country: 'United States',
                latitude: '',
                longitude: '',
                radius: 100
            });
            const [isLoading, setIsLoading] = useState(false);
            const [mapError, setMapError] = useState('');
            const [map, setMap] = useState(null);
            const [marker, setMarker] = useState(null);
            const [circle, setCircle] = useState(null);

            useEffect(() => {
                if (isOpen && window.L) {
                    initializeMap();
                }
            }, [isOpen]);

            useEffect(() => {
                if (initialData) {
                    // Parse the address to populate form fields
                    const addressParts = initialData.address.split(', ');
                    setFormData({
                        name: initialData.name || '',
                        address1: addressParts[0] || '',
                        address2: '',
                        city: addressParts[1] || '',
                        state: addressParts[2]?.split(' ')[0] || '',
                        zipCode: addressParts[2]?.split(' ')[1] || '',
                        country: addressParts[3] || 'United States',
                        latitude: initialData.latitude?.toString() || '',
                        longitude: initialData.longitude?.toString() || '',
                        radius: initialData.radius || 100
                    });
                } else {
                    // Reset form for new job site
                    setFormData({
                        name: '',
                        address1: '',
                        address2: '',
                        city: '',
                        state: '',
                        zipCode: '',
                        country: 'United States',
                        latitude: '',
                        longitude: '',
                        radius: 100
                    });
                }
            }, [initialData, isOpen]);

            const initializeMap = () => {
                if (!window.L) {
                    setMapError('Map library not loaded');
                    return;
                }

                const mapInstance = window.L.map('job-site-map').setView([40.7128, -74.0060], 13);
                setMap(mapInstance);

                window.L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: 'Â© OpenStreetMap contributors'
                }).addTo(mapInstance);

                // Add click handler to map
                mapInstance.on('click', (e) => {
                    const { lat, lng } = e.latlng;
                    setFormData(prev => ({
                        ...prev,
                        latitude: lat.toFixed(6),
                        longitude: lng.toFixed(6)
                    }));
                    updateMapMarker(lat, lng);
                });
            };

            const updateMapMarker = (lat, lng) => {
                if (!map) return;

                // Remove existing marker and circle
                if (marker) {
                    map.removeLayer(marker);
                }
                if (circle) {
                    map.removeLayer(circle);
                }

                // Add new marker
                const newMarker = window.L.marker([lat, lng]).addTo(map);
                setMarker(newMarker);

                // Add radius circle
                const newCircle = window.L.circle([lat, lng], {
                    color: 'red',
                    fillColor: '#f03',
                    fillOpacity: 0.2,
                    radius: formData.radius
                }).addTo(map);
                setCircle(newCircle);

                // Center map on marker
                map.setView([lat, lng], 15);
            };

            const geocodeAddress = async () => {
                if (!formData.address1 || !formData.city || !formData.state) {
                    alert('Please fill in at least Address 1, City, and State');
                    return;
                }

                setIsLoading(true);
                setMapError('');

                try {
                    // Try multiple geocoding services as fallbacks
                    const address = `${formData.address1}, ${formData.city}, ${formData.state} ${formData.zipCode}, ${formData.country}`;
                    
                    // First try: OpenStreetMap Nominatim with proper headers
                    let coordinates = null;
                    
                    try {
                        const nominatimUrl = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}&limit=1&addressdetails=1&countrycodes=${formData.country === 'United States' ? 'us' : ''}`;
                        
                        const response = await fetch(nominatimUrl, {
                            headers: {
                                'User-Agent': 'TimeTracker-App/1.0 (https://timetracker.com)',
                                'Accept': 'application/json',
                                'Accept-Language': 'en-US,en;q=0.9'
                            }
                        });

                        if (response.ok) {
                            const data = await response.json();
                            if (data && data.length > 0) {
                                coordinates = {
                                    lat: parseFloat(data[0].lat),
                                    lng: parseFloat(data[0].lon)
                                };
                            }
                        }
                    } catch (nominatimError) {
                        console.log('Nominatim failed, trying alternative...', nominatimError);
                    }

                    // Fallback: Try a simpler address format
                    if (!coordinates) {
                        try {
                            const simpleAddress = `${formData.city}, ${formData.state}, ${formData.country}`;
                            const simpleUrl = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(simpleAddress)}&limit=1`;
                            
                            const response = await fetch(simpleUrl, {
                                headers: {
                                    'User-Agent': 'TimeTracker-App/1.0 (https://timetracker.com)',
                                    'Accept': 'application/json'
                                }
                            });

                            if (response.ok) {
                                const data = await response.json();
                                if (data && data.length > 0) {
                                    coordinates = {
                                        lat: parseFloat(data[0].lat),
                                        lng: parseFloat(data[0].lon)
                                    };
                                }
                            }
                        } catch (simpleError) {
                            console.log('Simple geocoding failed', simpleError);
                        }
                    }

                    // Final fallback: Try with just city and state
                    if (!coordinates) {
                        try {
                            const cityStateAddress = `${formData.city}, ${formData.state}`;
                            const cityStateUrl = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(cityStateAddress)}&limit=1`;
                            
                            const response = await fetch(cityStateUrl, {
                                headers: {
                                    'User-Agent': 'TimeTracker-App/1.0 (https://timetracker.com)',
                                    'Accept': 'application/json'
                                }
                            });

                            if (response.ok) {
                                const data = await response.json();
                                if (data && data.length > 0) {
                                    coordinates = {
                                        lat: parseFloat(data[0].lat),
                                        lng: parseFloat(data[0].lon)
                                    };
                                }
                            }
                        } catch (cityStateError) {
                            console.log('City/State geocoding failed', cityStateError);
                        }
                    }

                    if (coordinates) {
                        setFormData(prev => ({
                            ...prev,
                            latitude: coordinates.lat.toFixed(6),
                            longitude: coordinates.lng.toFixed(6)
                        }));

                        // Update map with new coordinates
                        setTimeout(() => {
                            updateMapMarker(coordinates.lat, coordinates.lng);
                        }, 100);
                        
                        setMapError(''); // Clear any previous errors
                    } else {
                        throw new Error('Address not found. No worries! You can still click directly on the map to select the exact location.');
                    }
                } catch (error) {
                    console.error('Geocoding error:', error);
                    setMapError(`Could not find location: ${error.message}. Please click directly on the map to select the location.`);
                } finally {
                    setIsLoading(false);
                }
            };

            const handleChange = (e) => {
                const { name, value } = e.target;
                setFormData(prev => ({
                    ...prev,
                    [name]: value
                }));

                // Update radius circle if radius changed
                if (name === 'radius' && circle && formData.latitude && formData.longitude) {
                    const newRadius = parseInt(value) || 100;
                    circle.setRadius(newRadius);
                }
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                
                if (!formData.latitude || !formData.longitude) {
                    alert('Please select a location on the map or use the geocoding feature');
                    return;
                }

                const jobSiteData = {
                    name: formData.name,
                    address: `${formData.address1}${formData.address2 ? ', ' + formData.address2 : ''}, ${formData.city}, ${formData.state} ${formData.zipCode}, ${formData.country}`,
                    latitude: parseFloat(formData.latitude),
                    longitude: parseFloat(formData.longitude),
                    radius: parseInt(formData.radius)
                };

                onSave(jobSiteData);
                onClose();
            };

            if (!isOpen) return null;

            return React.createElement('div', { className: 'job-site-modal' },
                React.createElement('div', { className: 'job-site-modal-content' },
                    React.createElement('h2', null, initialData ? 'Edit Job Site' : 'Add New Job Site'),
                    React.createElement('form', { onSubmit: handleSubmit },
                        React.createElement('div', { className: 'address-form' },
                            React.createElement('input', {
                                type: 'text',
                                name: 'name',
                                placeholder: 'Job Site Name',
                                value: formData.name,
                                onChange: handleChange,
                                required: true,
                                className: 'full-width'
                            }),
                            React.createElement('input', {
                                type: 'text',
                                name: 'address1',
                                placeholder: 'Address 1',
                                value: formData.address1,
                                onChange: handleChange,
                                required: true,
                                className: 'full-width'
                            }),
                            React.createElement('input', {
                                type: 'text',
                                name: 'address2',
                                placeholder: 'Address 2 (Optional)',
                                value: formData.address2,
                                onChange: handleChange
                            }),
                            React.createElement('input', {
                                type: 'text',
                                name: 'city',
                                placeholder: 'City',
                                value: formData.city,
                                onChange: handleChange,
                                required: true
                            }),
                            React.createElement('input', {
                                type: 'text',
                                name: 'state',
                                placeholder: 'State',
                                value: formData.state,
                                onChange: handleChange,
                                required: true
                            }),
                            React.createElement('input', {
                                type: 'text',
                                name: 'zipCode',
                                placeholder: 'ZIP Code',
                                value: formData.zipCode,
                                onChange: handleChange
                            }),
                            React.createElement('input', {
                                type: 'text',
                                name: 'country',
                                placeholder: 'Country',
                                value: formData.country,
                                onChange: handleChange,
                                required: true
                            })
                        ),
                        React.createElement('div', { className: 'geocoding-section' },
                            React.createElement('h4', null, 'Location Selection'),
                            React.createElement('p', { style: { fontSize: '14px', color: '#666', marginBottom: '10px' } }, 
                                'Choose one of these methods to set the job site location:'
                            ),
                            React.createElement('div', { style: { marginBottom: '15px' } },
                                React.createElement('div', { style: { display: 'flex', alignItems: 'center', marginBottom: '8px' } },
                                    React.createElement('span', { style: { fontWeight: 'bold', marginRight: '8px' } }, 'Method 1:'),
                                    React.createElement('span', { style: { fontSize: '14px' } }, 'Enter address above and click "Find Location"')
                                ),
                                React.createElement('div', { style: { display: 'flex', alignItems: 'center' } },
                                    React.createElement('span', { style: { fontWeight: 'bold', marginRight: '8px' } }, 'Method 2:'),
                                    React.createElement('span', { style: { fontSize: '14px' } }, 'Click directly on the map where the job site is located')
                                )
                            ),
                            React.createElement('div', { className: 'geocoding-buttons' },
                                React.createElement('button', {
                                    type: 'button',
                                    className: 'btn btn-outline',
                                    onClick: geocodeAddress,
                                    disabled: isLoading
                                }, isLoading ? 'Finding...' : 'Find Location'),
                                React.createElement('span', { style: { fontSize: '12px', color: '#666', alignSelf: 'center', marginLeft: '10px' } }, 
                                    'OR click on the map below â†“'
                                )
                            ),
                            mapError && React.createElement('div', { className: 'map-error' }, mapError)
                        ),
                        React.createElement('div', { className: 'map-container' },
                            React.createElement('div', { 
                                id: 'job-site-map', 
                                style: { 
                                    height: '100%', 
                                    width: '100%',
                                    cursor: 'crosshair',
                                    position: 'relative'
                                } 
                            }),
                            React.createElement('div', { 
                                style: { 
                                    position: 'absolute',
                                    top: '10px',
                                    left: '10px',
                                    background: 'rgba(0, 0, 0, 0.7)',
                                    color: 'white',
                                    padding: '8px 12px',
                                    borderRadius: '4px',
                                    fontSize: '12px',
                                    pointerEvents: 'none',
                                    zIndex: '1000'
                                } 
                            }, 'Click on the map to select location')
                        ),
                        React.createElement('div', { style: { display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '15px', marginTop: '15px' } },
                            React.createElement('div', null,
                                React.createElement('label', { style: { display: 'block', marginBottom: '5px', fontWeight: 'bold' } }, 'Latitude'),
                                React.createElement('input', {
                                    type: 'number',
                                    name: 'latitude',
                                    value: formData.latitude,
                                    onChange: handleChange,
                                    step: '0.000001',
                                    required: true,
                                    style: { width: '100%' }
                                })
                            ),
                            React.createElement('div', null,
                                React.createElement('label', { style: { display: 'block', marginBottom: '5px', fontWeight: 'bold' } }, 'Longitude'),
                                React.createElement('input', {
                                    type: 'number',
                                    name: 'longitude',
                                    value: formData.longitude,
                                    onChange: handleChange,
                                    step: '0.000001',
                                    required: true,
                                    style: { width: '100%' }
                                })
                            )
                        ),
                        React.createElement('div', { style: { marginTop: '15px' } },
                            React.createElement('label', { style: { display: 'block', marginBottom: '5px', fontWeight: 'bold' } }, 'Clock-in Radius (meters)'),
                            React.createElement('input', {
                                type: 'number',
                                name: 'radius',
                                value: formData.radius,
                                onChange: handleChange,
                                min: '10',
                                max: '1000',
                                required: true,
                                style: { width: '100%' }
                            }),
                            React.createElement('p', { style: { fontSize: '12px', color: '#666', marginTop: '5px' } }, 
                                'Employees must be within this distance to clock in/out'
                            )
                        ),
                        React.createElement('div', { className: 'btn-group', style: { marginTop: '20px', justifyContent: 'flex-end' } },
                            React.createElement('button', {
                                type: 'button',
                                className: 'btn btn-outline',
                                onClick: onClose
                            }, 'Cancel'),
                            React.createElement('button', {
                                type: 'submit',
                                className: 'btn btn-primary',
                                disabled: !formData.latitude || !formData.longitude
                            }, 'Save Job Site')
                        )
                    )
                )
            );
        };

        // Main App Component
        // Dashboard Components
        const EmployeeDashboard = ({ user, onLogout }) => {
            const { currentLocation, getCurrentLocation, calculateDistance } = useData();
            const [timeEntries, setTimeEntries] = useState([]);
            const [jobSites, setJobSites] = useState([]);
            const [isClockedIn, setIsClockedIn] = useState(false);
            const [currentTimeEntry, setCurrentTimeEntry] = useState(null);
            const [locationError, setLocationError] = useState('');

            useEffect(() => {
                loadData();
                getCurrentLocation();
            }, []);

            const loadData = () => {
                const storedEntries = JSON.parse(localStorage.getItem('timeEntries') || '[]');
                const storedSites = JSON.parse(localStorage.getItem('jobSites') || '[]');
                
                // Filter entries for current user
                const userEntries = storedEntries.filter(entry => entry.userId === user.id);
                setTimeEntries(userEntries);
                setJobSites(storedSites);
                
                // Check if user is currently clocked in
                const activeEntry = userEntries.find(entry => !entry.clockOut);
                setIsClockedIn(!!activeEntry);
                setCurrentTimeEntry(activeEntry);
            };

            const handleRefreshLocation = async () => {
                try {
                    setLocationError('');
                    console.log('Refreshing location...');
                    await getCurrentLocation();
                    console.log('Location refreshed successfully');
                } catch (error) {
                    console.error('Location refresh failed:', error);
                    setLocationError(error.message || 'Failed to get location. Please try again.');
                }
            };

            const handleClockIn = async () => {
                try {
                    const location = await getCurrentLocation();
                    const site = jobSites.find(site => {
                        const distance = calculateDistance(
                            location.lat, location.lng,
                            site.latitude, site.longitude
                        );
                        return distance <= site.radius;
                    });

                    if (!site) {
                        alert('You must be within a job site radius to clock in.');
                        return;
                    }

                    const newEntry = {
                        id: Date.now().toString(),
                        userId: user.id,
                        jobSiteId: site.id,
                        clockIn: new Date().toISOString(),
                        clockOut: null,
                        location: location
                    };

                    const updatedEntries = [...timeEntries, newEntry];
                    setTimeEntries(updatedEntries);
                    localStorage.setItem('timeEntries', JSON.stringify(updatedEntries));
                    
                    setIsClockedIn(true);
                    setCurrentTimeEntry(newEntry);
                    loadData();
                } catch (error) {
                    alert('Failed to get location. Please enable location services and try again.');
                }
            };

            const handleClockOut = () => {
                if (!currentTimeEntry) return;

                const updatedEntries = timeEntries.map(entry => 
                    entry.id === currentTimeEntry.id 
                        ? { ...entry, clockOut: new Date().toISOString() }
                        : entry
                );

                setTimeEntries(updatedEntries);
                localStorage.setItem('timeEntries', JSON.stringify(updatedEntries));
                
                setIsClockedIn(false);
                setCurrentTimeEntry(null);
                loadData();
            };

            const getJobSiteStatus = (site) => {
                if (!currentLocation) return { status: 'No location', distance: 'N/A' };
                
                const distance = calculateDistance(
                    currentLocation.lat, currentLocation.lng,
                    site.latitude, site.longitude
                );
                
                const isWithinRadius = distance <= site.radius;
                return {
                    status: isWithinRadius ? 'Within range' : 'Out of range',
                    distance: `${distance.toFixed(1)}m`
                };
            };

            const getTotalHoursThisWeek = () => {
                const now = new Date();
                const startOfWeek = new Date(now.setDate(now.getDate() - now.getDay()));
                const endOfWeek = new Date(now.setDate(now.getDate() - now.getDay() + 6));
                
                return timeEntries
                    .filter(entry => entry.clockOut && 
                        new Date(entry.clockIn) >= startOfWeek && 
                        new Date(entry.clockIn) <= endOfWeek)
                    .reduce((total, entry) => {
                        const hours = (new Date(entry.clockOut) - new Date(entry.clockIn)) / (1000 * 60 * 60);
                        return total + hours;
                    }, 0);
            };

            const getTotalHoursThisMonth = () => {
                const now = new Date();
                const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);
                const endOfMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0);
                
                return timeEntries
                    .filter(entry => entry.clockOut && 
                        new Date(entry.clockIn) >= startOfMonth && 
                        new Date(entry.clockIn) <= endOfMonth)
                    .reduce((total, entry) => {
                        const hours = (new Date(entry.clockOut) - new Date(entry.clockIn)) / (1000 * 60 * 60);
                        return total + hours;
                    }, 0);
            };

            const getTotalHoursAllTime = () => {
                return timeEntries
                    .filter(entry => entry.clockOut)
                    .reduce((total, entry) => {
                        const hours = (new Date(entry.clockOut) - new Date(entry.clockIn)) / (1000 * 60 * 60);
                        return total + hours;
                    }, 0);
            };

            const getHoursByJobSite = () => {
                const siteHours = {};
                timeEntries
                    .filter(entry => entry.clockOut)
                    .forEach(entry => {
                        const site = jobSites.find(s => s.id === entry.jobSiteId);
                        if (site) {
                            if (!siteHours[site.id]) {
                                siteHours[site.id] = { name: site.name, hours: 0 };
                            }
                            const hours = (new Date(entry.clockOut) - new Date(entry.clockIn)) / (1000 * 60 * 60);
                            siteHours[site.id].hours += hours;
                        }
                    });
                return Object.values(siteHours);
            };

            return React.createElement('div', { className: 'container' },
                React.createElement('div', { className: 'card' },
                    React.createElement('div', { className: 'card-header' },
                        React.createElement('h1', null, `Welcome, ${user.firstName}!`),
                        React.createElement('button', { 
                            className: 'btn btn-outline',
                            onClick: onLogout
                        }, 'Logout')
                    ),
                    
                    // Location Status
                    React.createElement('div', { className: 'card', style: { marginBottom: '20px' } },
                        React.createElement('h3', null, 'Location Status'),
                        React.createElement('div', { style: { display: 'flex', alignItems: 'center', gap: '10px', marginBottom: '10px', flexWrap: 'wrap' } },
                            React.createElement('button', { 
                                className: 'btn btn-sm',
                                onClick: handleRefreshLocation
                            }, 'ðŸ”„ Refresh'),
                            React.createElement('button', { 
                                className: 'btn btn-sm',
                                onClick: () => {
                                    console.log('Setting test location...');
                                    const testLocation = {
                                        lat: 40.7128,
                                        lng: -74.0060,
                                        accuracy: 10,
                                        timestamp: Date.now()
                                    };
                                    setCurrentLocation(testLocation);
                                    console.log('Test location set:', testLocation);
                                }
                            }, 'ðŸ“ Test Location'),
                            React.createElement('button', { 
                                className: 'btn btn-sm',
                                onClick: () => {
                                    // Try to get location with different settings for mobile
                                    console.log('Trying mobile-optimized location...');
                                    navigator.geolocation.getCurrentPosition(
                                        (position) => {
                                            const location = {
                                                lat: position.coords.latitude,
                                                lng: position.coords.longitude,
                                                accuracy: position.coords.accuracy,
                                                timestamp: Date.now()
                                            };
                                            setCurrentLocation(location);
                                            console.log('Mobile location obtained:', location);
                                        },
                                        (error) => {
                                            console.error('Mobile location failed:', error);
                                            alert(`Mobile location failed: ${error.message}\n\nTry:\n1. Allow location access\n2. Use HTTPS\n3. Check GPS settings`);
                                        },
                                        {
                                            enableHighAccuracy: false, // Try with lower accuracy first
                                            timeout: 30000,
                                            maximumAge: 0
                                        }
                                    );
                                }
                            }, 'ðŸ“± Mobile Fix')
                        ),
                        React.createElement('div', { style: { fontSize: '0.9rem', color: '#666', marginBottom: '10px' } },
                            currentLocation ? 
                                `Lat: ${currentLocation.lat.toFixed(6)}, Lng: ${currentLocation.lng.toFixed(6)}` : 
                                'Getting location...'
                        ),
                        currentLocation && React.createElement('div', { style: { fontSize: '0.9rem', color: '#666', marginBottom: '10px' } },
                            `Accuracy: ${currentLocation.accuracy ? Math.round(currentLocation.accuracy) : 'N/A'}m`
                        ),
                        !currentLocation && React.createElement('div', { 
                            style: { 
                                color: '#f59e0b', 
                                backgroundColor: '#fffbeb', 
                                padding: '10px', 
                                borderRadius: '4px', 
                                marginTop: '10px',
                                border: '1px solid #fde68a',
                                fontSize: '0.9rem'
                            } 
                        }, 
                            'ðŸ“± Mobile Location Tips:\n' +
                            'â€¢ Make sure location access is allowed\n' +
                            'â€¢ Try using HTTPS instead of HTTP\n' +
                            'â€¢ Check your device GPS settings\n' +
                            'â€¢ Use "Mobile Fix" button above\n' +
                            'â€¢ Or use "Test Location" for demo'
                        ),
                        locationError && React.createElement('div', { 
                            style: { 
                                color: '#e74c3c', 
                                backgroundColor: '#fdf2f2', 
                                padding: '10px', 
                                borderRadius: '4px', 
                                marginTop: '10px',
                                border: '1px solid #fecaca',
                                whiteSpace: 'pre-line'
                            } 
                        }, `âš ï¸ ${locationError}`)
                    ),

                    // Clock In/Out Section
                    React.createElement('div', { className: 'card', style: { marginBottom: '20px' } },
                        React.createElement('h3', null, 'Time Tracking'),
                        React.createElement('div', { style: { display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '15px' } },
                            jobSites.map(site => {
                                const status = getJobSiteStatus(site);
                                return React.createElement('div', { 
                                    key: site.id,
                                    className: 'card',
                                    style: { padding: '15px', backgroundColor: status.status === 'Within range' ? '#e8f5e8' : '#f5f5f5' }
                                },
                                    React.createElement('h4', null, site.name),
                                    React.createElement('p', null, `Address: ${site.address}`),
                                    React.createElement('p', null, `Status: ${status.status}`),
                                    React.createElement('p', null, `Distance: ${status.distance}`)
                                );
                            })
                        ),
                        React.createElement('div', { style: { marginTop: '20px', textAlign: 'center' } },
                            isClockedIn ? 
                                React.createElement('div', null,
                                    React.createElement('p', { style: { marginBottom: '10px' } }, 
                                        `Clocked in at ${new Date(currentTimeEntry.clockIn).toLocaleTimeString()}`
                                    ),
                                    React.createElement('button', { 
                                        className: 'btn btn-danger',
                                        onClick: handleClockOut
                                    }, 'Clock Out')
                                ) :
                                React.createElement('button', { 
                                    className: 'btn btn-primary',
                                    onClick: handleClockIn,
                                    disabled: !currentLocation
                                }, 'Clock In')
                        )
                    ),

                    // Hours Summary
                    React.createElement('div', { className: 'card', style: { marginBottom: '20px' } },
                        React.createElement('h3', null, 'Hours Summary'),
                        React.createElement('div', { className: 'summary-stats' },
                            React.createElement('div', { className: 'stat' },
                                React.createElement('div', { className: 'stat-value' }, getTotalHoursThisWeek().toFixed(1)),
                                React.createElement('div', { className: 'stat-label' }, 'This Week')
                            ),
                            React.createElement('div', { className: 'stat' },
                                React.createElement('div', { className: 'stat-value' }, getTotalHoursThisMonth().toFixed(1)),
                                React.createElement('div', { className: 'stat-label' }, 'This Month')
                            ),
                            React.createElement('div', { className: 'stat' },
                                React.createElement('div', { className: 'stat-value' }, getTotalHoursAllTime().toFixed(1)),
                                React.createElement('div', { className: 'stat-label' }, 'All Time')
                            )
                        )
                    ),

                    // Hours by Job Site
                    React.createElement('div', { className: 'card' },
                        React.createElement('h3', null, 'Hours by Job Site'),
                        React.createElement('div', { className: 'hours-by-site' },
                            getHoursByJobSite().map(site => 
                                React.createElement('div', { key: site.name, className: 'site-hours-item' },
                                    React.createElement('div', { className: 'site-name' }, site.name),
                                    React.createElement('div', { className: 'site-hours' }, `${site.hours.toFixed(1)}h`)
                                )
                            )
                        )
                    )
                )
            );
        };

        const ManagerDashboard = ({ user, onLogout }) => {
            const [employees, setEmployees] = useState([]);
            const [jobSites, setJobSites] = useState([]);
            const [timeEntries, setTimeEntries] = useState([]);
            const [currentView, setCurrentView] = useState('overview');

            useEffect(() => {
                loadData();
            }, []);

            const loadData = () => {
                const storedUsers = JSON.parse(localStorage.getItem('users') || '[]');
                const storedSites = JSON.parse(localStorage.getItem('jobSites') || '[]');
                const storedEntries = JSON.parse(localStorage.getItem('timeEntries') || '[]');
                
                // Filter employees (users with role 'employee' in same company)
                const companyEmployees = storedUsers.filter(u => 
                    u.role === 'employee' && u.companyId === user.companyId
                );
                
                // Filter job sites for current company
                const companyJobSites = storedSites.filter(site => 
                    site.companyId === user.companyId
                );
                
                // Filter time entries for company employees
                const companyEntries = storedEntries.filter(entry => 
                    companyEmployees.some(emp => emp.id === entry.userId)
                );
                
                setEmployees(companyEmployees);
                setJobSites(companyJobSites);
                setTimeEntries(companyEntries);
            };

            const getTotalHoursThisWeek = (userId) => {
                const now = new Date();
                const startOfWeek = new Date(now.setDate(now.getDate() - now.getDay()));
                startOfWeek.setHours(0, 0, 0, 0);
                
                return timeEntries
                    .filter(entry => entry.userId === userId && entry.clockOut)
                    .filter(entry => new Date(entry.clockIn) >= startOfWeek)
                    .reduce((total, entry) => {
                        const clockIn = new Date(entry.clockIn);
                        const clockOut = new Date(entry.clockOut);
                        return total + (clockOut - clockIn) / (1000 * 60 * 60);
                    }, 0);
            };

            return React.createElement('div', { className: 'container' },
                React.createElement('div', { className: 'card' },
                    React.createElement('div', { className: 'card-header' },
                        React.createElement('h1', null, `Manager Dashboard - Welcome, ${user.firstName}!`),
                        React.createElement('div', { className: 'btn-group' },
                            React.createElement('button', {
                                className: `btn ${currentView === 'overview' ? 'btn-primary' : 'btn-outline'}`,
                                onClick: () => setCurrentView('overview')
                            }, 'Overview'),
                            React.createElement('button', {
                                className: `btn ${currentView === 'employees' ? 'btn-primary' : 'btn-outline'}`,
                                onClick: () => setCurrentView('employees')
                            }, 'Employees'),
                            React.createElement('button', {
                                className: `btn ${currentView === 'job-sites' ? 'btn-primary' : 'btn-outline'}`,
                                onClick: () => setCurrentView('job-sites')
                            }, 'Job Sites'),
                            React.createElement('button', {
                                className: 'btn btn-outline',
                                onClick: onLogout
                            }, 'Logout')
                        )
                    ),
                    currentView === 'overview' && React.createElement('div', { className: 'overview' },
                        React.createElement('h2', null, 'Team Overview'),
                        React.createElement('div', { className: 'summary-cards' },
                            React.createElement('div', { className: 'summary-card' },
                                React.createElement('h3', null, 'Total Employees'),
                                React.createElement('div', { className: 'stat-value' }, employees.length)
                            ),
                            React.createElement('div', { className: 'summary-card' },
                                React.createElement('h3', null, 'Active Job Sites'),
                                React.createElement('div', { className: 'stat-value' }, jobSites.length)
                            ),
                            React.createElement('div', { className: 'summary-card' },
                                React.createElement('h3', null, 'Total Hours This Week'),
                                React.createElement('div', { className: 'stat-value' }, 
                                    Math.round(employees.reduce((total, emp) => total + getTotalHoursThisWeek(emp.id), 0) * 10) / 10
                                )
                            )
                        ),
                        React.createElement('h3', null, 'Employee Hours This Week'),
                        React.createElement('div', { className: 'employee-hours' },
                            employees.map(emp => 
                                React.createElement('div', { key: emp.id, className: 'employee-hours-item' },
                                    React.createElement('span', { className: 'employee-name' }, `${emp.firstName} ${emp.lastName}`),
                                    React.createElement('span', { className: 'employee-hours' }, 
                                        `${Math.round(getTotalHoursThisWeek(emp.id) * 10) / 10}h`
                                    )
                                )
                            )
                        )
                    ),
                    currentView === 'employees' && React.createElement('div', { className: 'employees' },
                        React.createElement('h2', null, 'Employees'),
                        React.createElement('div', { className: 'employee-list' },
                            employees.map(emp => 
                                React.createElement('div', { key: emp.id, className: 'employee-card' },
                                    React.createElement('h3', null, `${emp.firstName} ${emp.lastName}`),
                                    React.createElement('p', null, `Email: ${emp.email}`),
                                    React.createElement('p', null, `This Week: ${Math.round(getTotalHoursThisWeek(emp.id) * 10) / 10}h`)
                                )
                            )
                        )
                    ),
                    currentView === 'job-sites' && React.createElement('div', { className: 'job-sites' },
                        React.createElement('h2', null, 'Job Sites'),
                        React.createElement('div', { className: 'job-site-list' },
                            jobSites.map(site => 
                                React.createElement('div', { key: site.id, className: 'job-site-card' },
                                    React.createElement('h3', null, site.name),
                                    React.createElement('p', null, site.address),
                                    React.createElement('p', null, `Radius: ${site.radius}m`)
                                )
                            )
                        )
                    )
                )
            );
        };

        const OwnerDashboard = ({ user, onLogout }) => {
            const [employees, setEmployees] = useState([]);
            const [managers, setManagers] = useState([]);
            const [jobSites, setJobSites] = useState([]);
            const [timeEntries, setTimeEntries] = useState([]);
            const [currentView, setCurrentView] = useState('overview');
            const [showAddEmployee, setShowAddEmployee] = useState(false);
            const [showAddManager, setShowAddManager] = useState(false);
            const [showAddJobSite, setShowAddJobSite] = useState(false);
            const [editingJobSite, setEditingJobSite] = useState(null);
            const [editingEmployee, setEditingEmployee] = useState(null);
            const [editingManager, setEditingManager] = useState(null);

            useEffect(() => {
                loadData();
            }, []);

            const loadData = () => {
                const storedUsers = JSON.parse(localStorage.getItem('users') || '[]');
                const storedSites = JSON.parse(localStorage.getItem('jobSites') || '[]');
                const storedEntries = JSON.parse(localStorage.getItem('timeEntries') || '[]');
                
                // Filter users by company
                const companyEmployees = storedUsers.filter(u => 
                    u.role === 'employee' && u.companyId === user.companyId
                );
                const companyManagers = storedUsers.filter(u => 
                    u.role === 'manager' && u.companyId === user.companyId
                );
                
                // Filter job sites for current company
                const companyJobSites = storedSites.filter(site => 
                    site.companyId === user.companyId
                );
                
                // Filter time entries for company users
                const companyEntries = storedEntries.filter(entry => 
                    [...companyEmployees, ...companyManagers].some(emp => emp.id === entry.userId)
                );
                
                setEmployees(companyEmployees);
                setManagers(companyManagers);
                setJobSites(companyJobSites);
                setTimeEntries(companyEntries);
            };

            const getTotalHoursThisWeek = (userId) => {
                const now = new Date();
                const startOfWeek = new Date(now.setDate(now.getDate() - now.getDay()));
                startOfWeek.setHours(0, 0, 0, 0);
                
                return timeEntries
                    .filter(entry => entry.userId === userId && entry.clockOut)
                    .filter(entry => new Date(entry.clockIn) >= startOfWeek)
                    .reduce((total, entry) => {
                        const clockIn = new Date(entry.clockIn);
                        const clockOut = new Date(entry.clockOut);
                        return total + (clockOut - clockIn) / (1000 * 60 * 60);
                    }, 0);
            };

            const addEmployee = (employeeData) => {
                const newEmployee = {
                    id: 'emp-' + Date.now(),
                    ...employeeData,
                    role: 'employee',
                    companyId: user.companyId,
                    emailVerified: false,
                    createdAt: new Date().toISOString()
                };
                
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                users.push(newEmployee);
                localStorage.setItem('users', JSON.stringify(users));
                loadData();
                setShowAddEmployee(false);
                
                // Send email confirmation
                sendEmailConfirmation(newEmployee);
            };

            const addManager = (managerData) => {
                const newManager = {
                    id: 'mgr-' + Date.now(),
                    ...managerData,
                    role: 'manager',
                    companyId: user.companyId,
                    emailVerified: false,
                    createdAt: new Date().toISOString()
                };
                
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                users.push(newManager);
                localStorage.setItem('users', JSON.stringify(users));
                loadData();
                setShowAddManager(false);
                
                // Send email confirmation
                sendEmailConfirmation(newManager);
            };

            const addJobSite = (jobSiteData) => {
                const newJobSite = {
                    id: 'site-' + Date.now(),
                    ...jobSiteData,
                    companyId: user.companyId,
                    createdAt: new Date().toISOString()
                };
                
                const sites = JSON.parse(localStorage.getItem('jobSites') || '[]');
                sites.push(newJobSite);
                localStorage.setItem('jobSites', JSON.stringify(sites));
                loadData();
                setShowAddJobSite(false);
            };

            const editJobSite = (jobSiteData) => {
                const sites = JSON.parse(localStorage.getItem('jobSites') || '[]');
                const siteIndex = sites.findIndex(site => site.id === editingJobSite.id);
                
                if (siteIndex !== -1) {
                    sites[siteIndex] = {
                        ...sites[siteIndex],
                        ...jobSiteData,
                        updatedAt: new Date().toISOString()
                    };
                    localStorage.setItem('jobSites', JSON.stringify(sites));
                    loadData();
                    setEditingJobSite(null);
                }
            };

            const deleteJobSite = (jobSiteId) => {
                if (confirm('Are you sure you want to delete this job site? This action cannot be undone.')) {
                    const sites = JSON.parse(localStorage.getItem('jobSites') || '[]');
                    const filteredSites = sites.filter(site => site.id !== jobSiteId);
                    localStorage.setItem('jobSites', JSON.stringify(filteredSites));
                    loadData();
                }
            };

            const editEmployee = (employeeData) => {
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const userIndex = users.findIndex(u => u.id === editingEmployee.id);
                
                if (userIndex !== -1) {
                    const updatedEmployee = {
                        ...users[userIndex],
                        ...employeeData,
                        updatedAt: new Date().toISOString()
                    };
                    
                    // Only update password if a new one was provided
                    if (!employeeData.password || employeeData.password.trim() === '') {
                        delete updatedEmployee.password; // Keep existing password
                    }
                    
                    users[userIndex] = updatedEmployee;
                    localStorage.setItem('users', JSON.stringify(users));
                    loadData();
                    setEditingEmployee(null);
                }
            };

            const editManager = (managerData) => {
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const userIndex = users.findIndex(u => u.id === editingManager.id);
                
                if (userIndex !== -1) {
                    const updatedManager = {
                        ...users[userIndex],
                        ...managerData,
                        updatedAt: new Date().toISOString()
                    };
                    
                    // Only update password if a new one was provided
                    if (!managerData.password || managerData.password.trim() === '') {
                        delete updatedManager.password; // Keep existing password
                    }
                    
                    users[userIndex] = updatedManager;
                    localStorage.setItem('users', JSON.stringify(users));
                    loadData();
                    setEditingManager(null);
                }
            };

            const deleteEmployee = (employeeId) => {
                if (confirm('Are you sure you want to delete this employee? This will also delete all their time entries. This action cannot be undone.')) {
                    const users = JSON.parse(localStorage.getItem('users') || '[]');
                    const filteredUsers = users.filter(u => u.id !== employeeId);
                    localStorage.setItem('users', JSON.stringify(filteredUsers));
                    
                    // Also delete time entries for this employee
                    const timeEntries = JSON.parse(localStorage.getItem('timeEntries') || '[]');
                    const filteredEntries = timeEntries.filter(entry => entry.userId !== employeeId);
                    localStorage.setItem('timeEntries', JSON.stringify(filteredEntries));
                    
                    loadData();
                }
            };

            const deleteManager = (managerId) => {
                if (confirm('Are you sure you want to delete this manager? This will also delete all their time entries. This action cannot be undone.')) {
                    const users = JSON.parse(localStorage.getItem('users') || '[]');
                    const filteredUsers = users.filter(u => u.id !== managerId);
                    localStorage.setItem('users', JSON.stringify(filteredUsers));
                    
                    // Also delete time entries for this manager
                    const timeEntries = JSON.parse(localStorage.getItem('timeEntries') || '[]');
                    const filteredEntries = timeEntries.filter(entry => entry.userId !== managerId);
                    localStorage.setItem('timeEntries', JSON.stringify(filteredEntries));
                    
                    loadData();
                }
            };

            // Email validation function
            const validateEmail = (email) => {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return emailRegex.test(email);
            };

            // Email confirmation system
            const sendEmailConfirmation = async (userData) => {
                try {
                    // In a real app, this would call your email service
                    console.log('Sending email confirmation to:', userData.email);
                    
                    // For demo purposes, we'll simulate email sending
                    const confirmationData = {
                        to: userData.email,
                        subject: 'Welcome to TimeTracker - Please Confirm Your Email',
                        template: 'email-confirmation',
                        data: {
                            firstName: userData.firstName,
                            lastName: userData.lastName,
                            role: userData.role,
                            companyName: companies.find(c => c.id === user.companyId)?.name || 'Your Company',
                            confirmationLink: `${window.location.origin}/confirm-email?token=${userData.id}&email=${encodeURIComponent(userData.email)}`
                        }
                    };
                    
                    // Simulate API call
                    console.log('Email confirmation data:', confirmationData);
                    
                    // In production, you would call your email service here
                    // await fetch('/api/send-email', { method: 'POST', body: JSON.stringify(confirmationData) });
                    
                    alert(`Email confirmation sent to ${userData.email}. Please check your inbox and click the confirmation link.`);
                } catch (error) {
                    console.error('Failed to send email confirmation:', error);
                    alert('User created but email confirmation failed. Please contact support.');
                }
            };

            // Weekly email reports
            const sendWeeklyReports = async () => {
                try {
                    const now = new Date();
                    const startOfWeek = new Date(now.setDate(now.getDate() - now.getDay()));
                    startOfWeek.setHours(0, 0, 0, 0);
                    
                    // Get all users in the company
                    const companyUsers = [...employees, ...managers].filter(u => u.emailVerified);
                    
                    for (const companyUser of companyUsers) {
                        const userTimeEntries = timeEntries.filter(entry => 
                            entry.userId === companyUser.id && 
                            new Date(entry.clockIn) >= startOfWeek
                        );
                        
                        const totalHours = userTimeEntries.reduce((total, entry) => {
                            if (entry.clockOut) {
                                const clockIn = new Date(entry.clockIn);
                                const clockOut = new Date(entry.clockOut);
                                return total + (clockOut - clockIn) / (1000 * 60 * 60);
                            }
                            return total;
                        }, 0);
                        
                        let reportData;
                        
                        if (companyUser.role === 'employee') {
                            reportData = {
                                to: companyUser.email,
                                subject: 'Your Weekly Time Report',
                                template: 'employee-weekly-report',
                                data: {
                                    firstName: companyUser.firstName,
                                    totalHours: Math.round(totalHours * 10) / 10,
                                    timeEntries: userTimeEntries,
                                    weekStart: startOfWeek.toDateString()
                                }
                            };
                        } else if (companyUser.role === 'manager') {
                            // Manager gets their own hours + their team's hours
                            const teamEmployees = employees.filter(emp => emp.emailVerified);
                            const teamHours = teamEmployees.reduce((total, emp) => {
                                const empEntries = timeEntries.filter(entry => 
                                    entry.userId === emp.id && 
                                    new Date(entry.clockIn) >= startOfWeek
                                );
                                return total + empEntries.reduce((empTotal, entry) => {
                                    if (entry.clockOut) {
                                        const clockIn = new Date(entry.clockIn);
                                        const clockOut = new Date(entry.clockOut);
                                        return empTotal + (clockOut - clockIn) / (1000 * 60 * 60);
                                    }
                                    return empTotal;
                                }, 0);
                            }, 0);
                            
                            reportData = {
                                to: companyUser.email,
                                subject: 'Manager Weekly Report - Team Performance',
                                template: 'manager-weekly-report',
                                data: {
                                    firstName: companyUser.firstName,
                                    yourHours: Math.round(totalHours * 10) / 10,
                                    teamHours: Math.round(teamHours * 10) / 10,
                                    teamMembers: teamEmployees.length,
                                    timeEntries: userTimeEntries,
                                    weekStart: startOfWeek.toDateString()
                                }
                            };
                        }
                        
                        if (reportData) {
                            console.log('Sending weekly report to:', companyUser.email, reportData);
                            // In production: await fetch('/api/send-email', { method: 'POST', body: JSON.stringify(reportData) });
                        }
                    }
                    
                    // Owner gets comprehensive report
                    const ownerReportData = {
                        to: user.email,
                        subject: 'Company Weekly Report - Complete Overview',
                        template: 'owner-weekly-report',
                        data: {
                            firstName: user.firstName,
                            totalEmployees: employees.length,
                            totalManagers: managers.length,
                            totalJobSites: jobSites.length,
                            totalHours: timeEntries.reduce((total, entry) => {
                                if (entry.clockOut) {
                                    const clockIn = new Date(entry.clockIn);
                                    const clockOut = new Date(entry.clockOut);
                                    return total + (clockOut - clockIn) / (1000 * 60 * 60);
                                }
                                return total;
                            }, 0),
                            weekStart: startOfWeek.toDateString()
                        }
                    };
                    
                    console.log('Sending owner weekly report:', ownerReportData);
                    // In production: await fetch('/api/send-email', { method: 'POST', body: JSON.stringify(ownerReportData) });
                    
                    alert('Weekly reports sent to all verified users!');
                } catch (error) {
                    console.error('Failed to send weekly reports:', error);
                    alert('Failed to send weekly reports. Please try again.');
                }
            };

            return React.createElement('div', { className: 'container' },
                React.createElement('div', { className: 'card' },
                    React.createElement('div', { className: 'card-header' },
                        React.createElement('h1', null, `Owner Dashboard - Welcome, ${user.firstName}!`),
                        React.createElement('div', { className: 'btn-group' },
                            React.createElement('button', {
                                className: `btn ${currentView === 'overview' ? 'btn-primary' : 'btn-outline'}`,
                                onClick: () => setCurrentView('overview')
                            }, 'Overview'),
                            React.createElement('button', {
                                className: `btn ${currentView === 'employees' ? 'btn-primary' : 'btn-outline'}`,
                                onClick: () => setCurrentView('employees')
                            }, 'Employees'),
                            React.createElement('button', {
                                className: `btn ${currentView === 'managers' ? 'btn-primary' : 'btn-outline'}`,
                                onClick: () => setCurrentView('managers')
                            }, 'Managers'),
                            React.createElement('button', {
                                className: `btn ${currentView === 'job-sites' ? 'btn-primary' : 'btn-outline'}`,
                                onClick: () => setCurrentView('job-sites')
                            }, 'Job Sites'),
                            React.createElement('button', {
                                className: 'btn btn-outline',
                                onClick: onLogout
                            }, 'Logout')
                        )
                    ),
                    currentView === 'overview' && React.createElement('div', { className: 'overview' },
                        React.createElement('h2', null, 'Company Overview'),
                        React.createElement('div', { className: 'summary-cards' },
                            React.createElement('div', { className: 'summary-card' },
                                React.createElement('h3', null, 'Total Employees'),
                                React.createElement('div', { className: 'stat-value' }, employees.length)
                            ),
                            React.createElement('div', { className: 'summary-card' },
                                React.createElement('h3', null, 'Managers'),
                                React.createElement('div', { className: 'stat-value' }, managers.length)
                            ),
                            React.createElement('div', { className: 'summary-card' },
                                React.createElement('h3', null, 'Job Sites'),
                                React.createElement('div', { className: 'stat-value' }, jobSites.length)
                            ),
                            React.createElement('div', { className: 'summary-card' },
                                React.createElement('h3', null, 'Total Hours This Week'),
                                React.createElement('div', { className: 'stat-value' }, 
                                    Math.round([...employees, ...managers].reduce((total, emp) => total + getTotalHoursThisWeek(emp.id), 0) * 10) / 10
                                )
                            )
                        ),
                        React.createElement('div', { style: { marginTop: '30px', textAlign: 'center' } },
                            React.createElement('h3', { style: { marginBottom: '15px' } }, 'Email Reports'),
                            React.createElement('p', { style: { color: '#666', marginBottom: '20px' } }, 
                                'Send weekly time reports to all verified users'
                            ),
                            React.createElement('button', {
                                className: 'btn btn-primary',
                                onClick: sendWeeklyReports,
                                style: { fontSize: '1.1rem', padding: '12px 24px' }
                            }, 'ðŸ“§ Send Weekly Reports')
                        )
                    ),
                    currentView === 'employees' && React.createElement('div', { className: 'employees' },
                        React.createElement('div', { className: 'section-header' },
                            React.createElement('h2', null, 'Employees'),
                            React.createElement('button', {
                                className: 'btn btn-primary',
                                onClick: () => setShowAddEmployee(true)
                            }, 'Add Employee')
                        ),
                        showAddEmployee && React.createElement('div', { className: 'add-employee-form' },
                            React.createElement('h3', null, 'Add New Employee'),
                            React.createElement('form', { onSubmit: (e) => {
                                e.preventDefault();
                                const formData = new FormData(e.target);
                                const employeeData = {
                                    username: formData.get('username'),
                                    password: formData.get('password'),
                                    email: formData.get('email'),
                                    firstName: formData.get('firstName'),
                                    lastName: formData.get('lastName')
                                };
                                
                                // Validate email
                                if (!validateEmail(employeeData.email)) {
                                    alert('Please enter a valid email address');
                                    return;
                                }
                                
                                addEmployee(employeeData);
                            }},
                                React.createElement('input', { type: 'text', name: 'username', placeholder: 'Username', required: true }),
                                React.createElement('input', { type: 'password', name: 'password', placeholder: 'Password', required: true }),
                                React.createElement('input', { type: 'email', name: 'email', placeholder: 'Email', required: true }),
                                React.createElement('input', { type: 'text', name: 'firstName', placeholder: 'First Name', required: true }),
                                React.createElement('input', { type: 'text', name: 'lastName', placeholder: 'Last Name', required: true }),
                                React.createElement('div', { className: 'btn-group' },
                                    React.createElement('button', { type: 'submit', className: 'btn btn-primary' }, 'Add Employee'),
                                    React.createElement('button', { type: 'button', className: 'btn btn-outline', onClick: () => setShowAddEmployee(false) }, 'Cancel')
                                )
                            )
                        ),
                        editingEmployee && React.createElement('div', { className: 'add-employee-form' },
                            React.createElement('h3', null, 'Edit Employee'),
                            React.createElement('form', { onSubmit: (e) => {
                                e.preventDefault();
                                const formData = new FormData(e.target);
                                const employeeData = {
                                    username: formData.get('username'),
                                    password: formData.get('password'),
                                    email: formData.get('email'),
                                    firstName: formData.get('firstName'),
                                    lastName: formData.get('lastName')
                                };
                                
                                // Validate email
                                if (!validateEmail(employeeData.email)) {
                                    alert('Please enter a valid email address');
                                    return;
                                }
                                
                                editEmployee(employeeData);
                            }},
                                React.createElement('input', { type: 'text', name: 'username', placeholder: 'Username', defaultValue: editingEmployee.username, required: true }),
                                React.createElement('input', { type: 'password', name: 'password', placeholder: 'New Password (leave blank to keep current)', defaultValue: '' }),
                                React.createElement('input', { type: 'email', name: 'email', placeholder: 'Email', defaultValue: editingEmployee.email, required: true }),
                                React.createElement('input', { type: 'text', name: 'firstName', placeholder: 'First Name', defaultValue: editingEmployee.firstName, required: true }),
                                React.createElement('input', { type: 'text', name: 'lastName', placeholder: 'Last Name', defaultValue: editingEmployee.lastName, required: true }),
                                React.createElement('div', { className: 'btn-group' },
                                    React.createElement('button', { type: 'submit', className: 'btn btn-primary' }, 'Update Employee'),
                                    React.createElement('button', { type: 'button', className: 'btn btn-outline', onClick: () => setEditingEmployee(null) }, 'Cancel')
                                )
                            )
                        ),
                        React.createElement('div', { className: 'employee-list' },
                            employees.map(emp => 
                                React.createElement('div', { key: emp.id, className: 'employee-card' },
                                    React.createElement('div', { style: { display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' } },
                                        React.createElement('div', { style: { flex: 1 } },
                                            React.createElement('h3', null, `${emp.firstName} ${emp.lastName}`),
                                            React.createElement('p', null, `Email: ${emp.email}`),
                                            React.createElement('p', null, `Verified: ${emp.emailVerified ? 'âœ… Yes' : 'âŒ No'}`),
                                            React.createElement('p', null, `This Week: ${Math.round(getTotalHoursThisWeek(emp.id) * 10) / 10}h`)
                                        ),
                                        React.createElement('div', { className: 'btn-group', style: { marginLeft: '10px' } },
                                            React.createElement('button', {
                                                className: 'btn btn-outline btn-sm',
                                                onClick: () => setEditingEmployee(emp),
                                                title: 'Edit Employee'
                                            }, 'âœï¸'),
                                            React.createElement('button', {
                                                className: 'btn btn-outline btn-sm',
                                                onClick: () => deleteEmployee(emp.id),
                                                title: 'Delete Employee',
                                                style: { color: '#dc3545' }
                                            }, 'ðŸ—‘ï¸')
                                        )
                                    )
                                )
                            )
                        )
                    ),
                    currentView === 'managers' && React.createElement('div', { className: 'managers' },
                        React.createElement('div', { className: 'section-header' },
                            React.createElement('h2', null, 'Managers'),
                            React.createElement('button', {
                                className: 'btn btn-primary',
                                onClick: () => setShowAddManager(true)
                            }, 'Add Manager')
                        ),
                        showAddManager && React.createElement('div', { className: 'add-manager-form' },
                            React.createElement('h3', null, 'Add New Manager'),
                            React.createElement('form', { onSubmit: (e) => {
                                e.preventDefault();
                                const formData = new FormData(e.target);
                                const managerData = {
                                    username: formData.get('username'),
                                    password: formData.get('password'),
                                    email: formData.get('email'),
                                    firstName: formData.get('firstName'),
                                    lastName: formData.get('lastName')
                                };
                                
                                // Validate email
                                if (!validateEmail(managerData.email)) {
                                    alert('Please enter a valid email address');
                                    return;
                                }
                                
                                addManager(managerData);
                            }},
                                React.createElement('input', { type: 'text', name: 'username', placeholder: 'Username', required: true }),
                                React.createElement('input', { type: 'password', name: 'password', placeholder: 'Password', required: true }),
                                React.createElement('input', { type: 'email', name: 'email', placeholder: 'Email Address', required: true }),
                                React.createElement('input', { type: 'text', name: 'firstName', placeholder: 'First Name', required: true }),
                                React.createElement('input', { type: 'text', name: 'lastName', placeholder: 'Last Name', required: true }),
                                React.createElement('div', { className: 'btn-group' },
                                    React.createElement('button', { type: 'submit', className: 'btn btn-primary' }, 'Add Manager'),
                                    React.createElement('button', { type: 'button', className: 'btn btn-outline', onClick: () => setShowAddManager(false) }, 'Cancel')
                                )
                            )
                        ),
                        editingManager && React.createElement('div', { className: 'add-manager-form' },
                            React.createElement('h3', null, 'Edit Manager'),
                            React.createElement('form', { onSubmit: (e) => {
                                e.preventDefault();
                                const formData = new FormData(e.target);
                                const managerData = {
                                    username: formData.get('username'),
                                    password: formData.get('password'),
                                    email: formData.get('email'),
                                    firstName: formData.get('firstName'),
                                    lastName: formData.get('lastName')
                                };
                                
                                // Validate email
                                if (!validateEmail(managerData.email)) {
                                    alert('Please enter a valid email address');
                                    return;
                                }
                                
                                editManager(managerData);
                            }},
                                React.createElement('input', { type: 'text', name: 'username', placeholder: 'Username', defaultValue: editingManager.username, required: true }),
                                React.createElement('input', { type: 'password', name: 'password', placeholder: 'New Password (leave blank to keep current)', defaultValue: '' }),
                                React.createElement('input', { type: 'email', name: 'email', placeholder: 'Email Address', defaultValue: editingManager.email, required: true }),
                                React.createElement('input', { type: 'text', name: 'firstName', placeholder: 'First Name', defaultValue: editingManager.firstName, required: true }),
                                React.createElement('input', { type: 'text', name: 'lastName', placeholder: 'Last Name', defaultValue: editingManager.lastName, required: true }),
                                React.createElement('div', { className: 'btn-group' },
                                    React.createElement('button', { type: 'submit', className: 'btn btn-primary' }, 'Update Manager'),
                                    React.createElement('button', { type: 'button', className: 'btn btn-outline', onClick: () => setEditingManager(null) }, 'Cancel')
                                )
                            )
                        ),
                        React.createElement('div', { className: 'manager-list' },
                            managers.map(mgr => 
                                React.createElement('div', { key: mgr.id, className: 'manager-card' },
                                    React.createElement('div', { style: { display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' } },
                                        React.createElement('div', { style: { flex: 1 } },
                                            React.createElement('h3', null, `${mgr.firstName} ${mgr.lastName}`),
                                            React.createElement('p', null, `Email: ${mgr.email}`),
                                            React.createElement('p', null, `Verified: ${mgr.emailVerified ? 'âœ… Yes' : 'âŒ No'}`),
                                            React.createElement('p', null, `This Week: ${Math.round(getTotalHoursThisWeek(mgr.id) * 10) / 10}h`)
                                        ),
                                        React.createElement('div', { className: 'btn-group', style: { marginLeft: '10px' } },
                                            React.createElement('button', {
                                                className: 'btn btn-outline btn-sm',
                                                onClick: () => setEditingManager(mgr),
                                                title: 'Edit Manager'
                                            }, 'âœï¸'),
                                            React.createElement('button', {
                                                className: 'btn btn-outline btn-sm',
                                                onClick: () => deleteManager(mgr.id),
                                                title: 'Delete Manager',
                                                style: { color: '#dc3545' }
                                            }, 'ðŸ—‘ï¸')
                                        )
                                    )
                                )
                            )
                        )
                    ),
                    currentView === 'job-sites' && React.createElement('div', { className: 'job-sites' },
                        React.createElement('div', { className: 'section-header' },
                            React.createElement('h2', null, 'Job Sites'),
                            React.createElement('button', {
                                className: 'btn btn-primary',
                                onClick: () => setShowAddJobSite(true)
                            }, 'Add Job Site')
                        ),
                        React.createElement(JobSiteModal, {
                            isOpen: showAddJobSite,
                            onClose: () => setShowAddJobSite(false),
                            onSave: addJobSite
                        }),
                        React.createElement(JobSiteModal, {
                            isOpen: !!editingJobSite,
                            onClose: () => setEditingJobSite(null),
                            onSave: editJobSite,
                            initialData: editingJobSite
                        }),
                        React.createElement('div', { className: 'job-site-list' },
                            jobSites.map(site => 
                                React.createElement('div', { key: site.id, className: 'job-site-card' },
                                    React.createElement('div', { style: { display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' } },
                                        React.createElement('div', { style: { flex: 1 } },
                                            React.createElement('h3', null, site.name),
                                            React.createElement('p', null, site.address),
                                            React.createElement('p', null, `Radius: ${site.radius}m`)
                                        ),
                                        React.createElement('div', { className: 'btn-group', style: { marginLeft: '10px' } },
                                            React.createElement('button', {
                                                className: 'btn btn-outline btn-sm',
                                                onClick: () => setEditingJobSite(site),
                                                title: 'Edit Job Site'
                                            }, 'âœï¸'),
                                            React.createElement('button', {
                                                className: 'btn btn-outline btn-sm',
                                                onClick: () => deleteJobSite(site.id),
                                                title: 'Delete Job Site',
                                                style: { color: '#dc3545' }
                                            }, 'ðŸ—‘ï¸')
                                        )
                                    )
                                )
                            )
                        )
                    )
                )
            );
        };

        const App = () => {
            const [currentView, setCurrentView] = useState('login');
            const [user, setUser] = useState(null);

            useEffect(() => {
                const savedUser = localStorage.getItem('currentUser');
                if (savedUser) {
                    const userData = JSON.parse(savedUser);
                    setUser(userData);
                }
            }, []);

            const handleLogin = (username, password) => {
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const foundUser = users.find(u => u.username === username && u.password === password);
                
                if (foundUser) {
                    const userData = { ...foundUser };
                    delete userData.password;
                    setUser(userData);
                    localStorage.setItem('currentUser', JSON.stringify(userData));
                    return true;
                }
                return false;
            };

            const handleRegister = (userData) => {
                console.log('Registering new user:', userData);
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                console.log('Current users before registration:', users.map(u => ({ username: u.username, role: u.role })));
                
                if (users.find(u => u.username === userData.username)) {
                    alert('Username already exists');
                    return false;
                }

                if (users.find(u => u.email === userData.email)) {
                    alert('Email already exists');
                    return false;
                }

                const newUser = {
                    id: Date.now().toString(),
                    ...userData,
                    createdAt: new Date().toISOString()
                };

                users.push(newUser);
                localStorage.setItem('users', JSON.stringify(users));
                console.log('User registered successfully. New user list:', users.map(u => ({ username: u.username, role: u.role })));
                
                const userDataForState = { ...newUser };
                delete userDataForState.password;
                setUser(userDataForState);
                localStorage.setItem('currentUser', JSON.stringify(userDataForState));
                
                return true;
            };

            const handleCompanyRegistration = (companyData, ownerData) => {
                const companies = JSON.parse(localStorage.getItem('companies') || '[]');
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                
                if (companies.find(c => c.name === companyData.name)) {
                    alert('Company name already exists');
                    return false;
                }

                if (users.find(u => u.username === ownerData.username)) {
                    alert('Username already exists');
                    return false;
                }

                if (users.find(u => u.email === ownerData.email)) {
                    alert('Email already exists');
                    return false;
                }

                const companyId = Date.now().toString();
                const ownerId = (Date.now() + 1).toString();

                const newCompany = {
                    id: companyId,
                    ...companyData,
                    createdAt: new Date().toISOString()
                };

                const newOwner = {
                    id: ownerId,
                    ...ownerData,
                    companyId: companyId,
                    role: 'owner',
                    createdAt: new Date().toISOString()
                };

                companies.push(newCompany);
                users.push(newOwner);
                
                localStorage.setItem('companies', JSON.stringify(companies));
                localStorage.setItem('users', JSON.stringify(users));
                
                const userDataForState = { ...newOwner };
                delete userDataForState.password;
                setUser(userDataForState);
                localStorage.setItem('currentUser', JSON.stringify(userDataForState));
                
                return true;
            };

            const handleLogout = () => {
                setUser(null);
                localStorage.removeItem('currentUser');
            };

            if (user) {
                // Render appropriate dashboard based on user role
                if (user.role === 'owner') {
                    return React.createElement(OwnerDashboard, { user, onLogout: handleLogout });
                } else if (user.role === 'manager') {
                    return React.createElement(ManagerDashboard, { user, onLogout: handleLogout });
                } else if (user.role === 'employee') {
                    return React.createElement(EmployeeDashboard, { user, onLogout: handleLogout });
                } else {
                    return React.createElement('div', { style: { padding: '20px', textAlign: 'center' } },
                        React.createElement('h1', null, `Welcome, ${user.firstName}!`),
                        React.createElement('p', { style: { marginBottom: '20px' } }, `Role: ${user.role}`),
                        React.createElement('button', { 
                            className: 'btn btn-outline',
                            onClick: handleLogout
                        }, 'Logout')
                    );
                }
            }

            return React.createElement('div', { className: 'container' },
                React.createElement('div', { className: 'login-card' },
                    React.createElement('div', { className: 'logo' }, 'â°'),
                    React.createElement('h1', null, 'TimeTracker'),
                    React.createElement('p', { className: 'subtitle' }, 'Multi-Company Location-Based Timesheet Platform'),
                    
                    React.createElement('div', { className: 'tab-container' },
                        React.createElement('button', { 
                            className: `tab ${currentView === 'login' ? 'active' : ''}`,
                            onClick: () => setCurrentView('login')
                        }, 'Login'),
                        React.createElement('button', { 
                            className: `tab ${currentView === 'register' ? 'active' : ''}`,
                            onClick: () => setCurrentView('register')
                        }, 'Register'),
                        React.createElement('button', { 
                            className: `tab ${currentView === 'company' ? 'active' : ''}`,
                            onClick: () => setCurrentView('company')
                        }, 'Start Company')
                    ),

                    currentView === 'login' && React.createElement(LoginForm, { onLogin: handleLogin }),
                    currentView === 'register' && React.createElement(RegisterForm, { onRegister: handleRegister }),
                    currentView === 'company' && React.createElement(CompanyRegistration, { onCompanyRegistration: handleCompanyRegistration })
                )
            );
        };

        // Clear any cached data and force fresh start
        console.log('TimeTracker v2.0 - Starting fresh...');
        console.log('Current time:', new Date().toISOString());
        
        // Render the app
        const root = createRoot(document.getElementById('root'));
        root.render(React.createElement(AuthProvider, null, 
            React.createElement(DataProvider, null, React.createElement(App))
        ));
    </script>
</body>
</html>
